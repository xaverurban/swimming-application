<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SwimmerAPI.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">swimming-application</a> &gt; <a href="index.source.html" class="el_package">controllers</a> &gt; <span class="el_source">SwimmerAPI.kt</span></div><h1>SwimmerAPI.kt</h1><pre class="source lang-java linenums">
package controllers

import models.Swimmer
import persistence.Serializer
import java.util.ArrayList
/**
 *This class provides an API for managing a list of swimmers and their associated races. It offers functionality to
 *add, search, list, update, and delete swimmers, as well as manage their races.
 *The SwimmerAPI interacts with a provided Serializer object to support storing and loading swimmer data.
 *It allows users to perform various operations on swimmers such as searching by name, listing active or archived
 *swimmers, and updating or archiving swimmers.
 *Additionally, this class provides methods to search for races based on their contents and list upcoming races,
 *as well as count swimmers and races based on different criteria.
 *@author Xaver Urban
 *@since v1.0
 * */

/**
 * SwimmerAPI class manages the swimmer data and provides various methods to manipulate
 * and query swimmer information.
 *
 * @param serializerType The type of serializer to be used for storing and loading data.
 */
<span class="fc" id="L25">class SwimmerAPI(serializerType: Serializer) {</span>

<span class="fc" id="L27">    private var swimmers = ArrayList&lt;Swimmer&gt;()</span>
<span class="fc" id="L28">    private var serializer: Serializer = serializerType</span>

    private var lastId = 0
<span class="fc" id="L31">    private fun getId() = lastId++</span>

    /**
     * Adds a new swimmer to the list of swimmers and assigns a unique ID to the swimmer.
     *
     * @param swimmer The swimmer object to be added.
     * @return Boolean indicating whether the swimmer was successfully added to the list.
     */
    fun add(swimmer: Swimmer): Boolean {
<span class="fc" id="L40">        swimmer.swimmerId = getId()</span>
<span class="fc" id="L41">        return swimmers.add(swimmer)</span>
    }

    /**
     * Searches for swimmers in the list by their name and returns a formatted string with the results.
     *
     * @param searchString The search string to be matched against swimmer names.
     * @return A formatted string with the list of matching swimmers.
     */
    fun searchSwimmersByName(searchString: String) =
<span class="nc" id="L51">        formatListString(</span>
<span class="nc" id="L52">            swimmers.filter { swimmer -&gt; swimmer.swimmerName.contains(searchString, ignoreCase = true) }</span>
<span class="nc" id="L53">        )</span>

    /**
     * Searches for races in the list of swimmers by their contents and returns a formatted string with the results.
     * This method searches through all the races of each swimmer and returns those races that contain the given
     * search string.
     *
     * @param searchString The search string to be matched against race contents.
     * @return A formatted string with the list of matching races along with their respective swimmer details.
     */
    fun searchRaceByContents(searchString: String): String {
<span class="nc bnc" id="L64" title="All 2 branches missed.">        return if (numberOfSwimmers() == 0) &quot;No swimmer stored&quot;</span>
        else {
<span class="nc" id="L66">            var listOfSwimmers = &quot;&quot;</span>
<span class="nc bnc" id="L67" title="All 2 branches missed.">            for (swimmer in swimmers) {</span>
<span class="nc bnc" id="L68" title="All 2 branches missed.">                for (race in swimmer.races) {</span>
<span class="nc bnc" id="L69" title="All 2 branches missed.">                    if (race.raceGraded.contains(searchString, ignoreCase = true)) {</span>
<span class="nc" id="L70">                        listOfSwimmers += &quot;${swimmer.swimmerId}: ${swimmer.swimmerName} \n\t${race}\n&quot;</span>
                    }
                }
            }
<span class="nc bnc" id="L74" title="All 2 branches missed.">            if (listOfSwimmers == &quot;&quot;) &quot;No races found for: $searchString&quot;</span>
<span class="nc" id="L75">            else listOfSwimmers</span>
        }
    }

    /**
     * Lists all ungraded races for all swimmers in a formatted string.
     *
     * @return A formatted string containing the list of upcoming races, or &quot;No swimmer stored&quot; if there are no swimmers.
     */
    fun listUngradedRaces(): String =
<span class="fc bfc" id="L85" title="All 2 branches covered.">        if (numberOfSwimmers() == 0) &quot;No swimmer stored&quot;</span>
        else {
<span class="fc" id="L87">            var listOfUngradedRaces = &quot;&quot;</span>
<span class="fc bfc" id="L88" title="All 2 branches covered.">            for (swimmer in swimmers) {</span>
<span class="fc bfc" id="L89" title="All 2 branches covered.">                for (race in swimmer.races) {</span>
<span class="fc bfc" id="L90" title="All 2 branches covered.">                    if (!race.isRaceOutdated) {</span>
<span class="fc" id="L91">                        listOfUngradedRaces += swimmer.swimmerName + &quot;: &quot; + race.raceGraded + &quot;\n&quot;</span>
                    }
                }
            }
<span class="fc" id="L95">            listOfUngradedRaces</span>
<span class="fc" id="L96">        }</span>

    /**
     * Counts the total number of ungraded races for all swimmers.
     *
     * @return The total number of upcoming races.
     */
    fun numberOfUngradedRaces(): Int {
<span class="fc" id="L104">        var numberOfToDoRaces = 0</span>
<span class="fc bfc" id="L105" title="All 2 branches covered.">        for (Swimmer in swimmers) {</span>
<span class="fc bfc" id="L106" title="All 2 branches covered.">            for (race in Swimmer.races) {</span>
<span class="fc bfc" id="L107" title="All 2 branches covered.">                if (!race.isRaceOutdated) {</span>
<span class="fc" id="L108">                    numberOfToDoRaces++</span>
                }
            }
        }
<span class="fc" id="L112">        return numberOfToDoRaces</span>
    }

    /**
     * Searches for swimmers in the list by their name and returns a list of matching swimmer objects.
     *
     * @param name The search string to be matched against swimmer names.
     * @return A list of Swimmer objects with matching names.
     */
<span class="fc" id="L121">    fun searchByName(name: String): List&lt;Swimmer&gt; = swimmers.filter { swimmer: Swimmer -&gt; swimmer.swimmerName.contains(name, ignoreCase = true) }</span>

    /**
     * Lists all swimmers in a formatted string.
     *
     * @return A formatted string containing the list of all swimmers, or &quot;No swimmer stored&quot; if there are no swimmers.
     */
    fun listAllSwimmers() =
<span class="fc bfc" id="L129" title="All 2 branches covered.">        if (swimmers.isEmpty()) &quot;No swimmer stored&quot;</span>
<span class="fc" id="L130">        else formatListString(swimmers)</span>

    /**
     * Lists all active swimmers in a formatted string.
     *
     * @return A formatted string containing the list of active swimmers, or &quot;No active swimmers stored&quot; if there are none.
     */
    fun listActiveSwimmers() =
<span class="fc bfc" id="L138" title="All 2 branches covered.">        if (numberOfActiveSwimmers() == 0) &quot;No active swimmers stored&quot;</span>
<span class="fc bfc" id="L139" title="All 2 branches covered.">        else formatListString(swimmers.filter { swimmer -&gt; !swimmer.isSwimmerArchived })</span>

    /**
     * Lists all archived swimmers in a formatted string.
     *
     * @return A formatted string containing the list of archived swimmers, or &quot;No archived swimmers stored&quot; if there are none.
     */
    fun listArchivedSwimmers(): String =
<span class="fc bfc" id="L147" title="All 2 branches covered.">        if (numberOfArchivedSwimmers() == 0) &quot;No archived swimmers stored&quot;</span>
<span class="fc" id="L148">        else formatListString(swimmers.filter { swimmer -&gt; swimmer.isSwimmerArchived })</span>

    /**
     * Counts the total number of swimmers at a specific level.
     *
     * @param level The level to match against swimmer levels.
     * @return The total number of swimmers at the specified level.
     */
<span class="fc bfc" id="L156" title="All 2 branches covered.">    fun numberOfSwimmersByLevel(level: Int): Int = swimmers.count { swimmer: Swimmer -&gt; swimmer.swimmerLevel == level }</span>

    /**
     * Archives a swimmer if they exist, are not already archived, and have completed all their races.
     *
     * @param id The unique ID of the swimmer to be archived.
     * @return Boolean indicating whether the swimmer was successfully archived.
     */
    fun archiveSwimmer(id: Int): Boolean {
<span class="fc" id="L165">        val foundSwimmer = findSwimmer(id)</span>
<span class="fc bfc" id="L166" title="All 4 branches covered.">        if ((foundSwimmer != null) &amp;&amp; (!foundSwimmer.isSwimmerArchived) &amp;&amp;</span>
<span class="pc bpc" id="L167" title="1 of 2 branches missed.">            (foundSwimmer.checkSwimmerCompletionStatus())</span>
        ) {
<span class="fc" id="L169">            foundSwimmer.isSwimmerArchived = true</span>
<span class="fc" id="L170">            return true</span>
        }
<span class="fc" id="L172">        return false</span>
    }

    /**
     * Finds a swimmer in the list by their unique ID.
     *
     * @param swimmerId The unique ID of the swimmer to be found.
     * @return The Swimmer object if found, or null if not found.
     */
<span class="fc bfc" id="L181" title="All 6 branches covered.">    fun findSwimmer(swimmerId: Int) = swimmers.find { swimmer -&gt; swimmer.swimmerId == swimmerId }</span>

    /**
     * Counts the total number of swimmers in the list.
     *
     * @return The total number of swimmers.
     */
<span class="fc" id="L188">    fun numberOfSwimmers() = swimmers.size</span>

    /**
     * Counts the total number of archived swimmers in the list.
     *
     * @return The total number of archived swimmers.
     */
<span class="fc" id="L195">    fun numberOfArchivedSwimmers(): Int = swimmers.count { swimmer: Swimmer -&gt; swimmer.isSwimmerArchived }</span>

    /**
     * Counts the total number of active swimmers in the list.
     *
     * @return The total number of active swimmers.
     */
<span class="fc bfc" id="L202" title="All 2 branches covered.">    fun numberOfActiveSwimmers(): Int = swimmers.count { swimmer: Swimmer -&gt; !swimmer.isSwimmerArchived }</span>

    /**
     * Deletes a swimmer from the list by their unique ID.
     *
     * @param id The unique ID of the swimmer to be deleted.
     * @return Boolean indicating whether the swimmer was successfully deleted.
     */
<span class="fc bfc" id="L210" title="All 2 branches covered.">    fun delete(id: Int) = swimmers.removeIf { swimmer -&gt; swimmer.swimmerId == id }</span>

    /**
     * Updates the details of a swimmer in the list.
     *
     * @param id The unique ID of the swimmer to be updated.
     * @param swimmer The Swimmer object containing the updated details.
     * @return Boolean indicating whether the swimmer was successfully updated.
     */
    fun update(id: Int, swimmer: Swimmer?): Boolean {
        // find the Swimmer object by the index number
<span class="fc" id="L221">        val foundSwimmer = findSwimmer(id)</span>
        // if the Swimmer exists, use the Swimmer details passed as parameters to update the found Swimmer in the ArrayList.
<span class="pc bpc" id="L223" title="1 of 4 branches missed.">        if ((foundSwimmer != null) &amp;&amp; (swimmer != null)) {</span>
<span class="fc" id="L224">            foundSwimmer.swimmerName = swimmer.swimmerName</span>
<span class="fc" id="L225">            foundSwimmer.swimmerLevel = swimmer.swimmerLevel</span>
<span class="fc" id="L226">            foundSwimmer.swimmerCategory = swimmer.swimmerCategory</span>
<span class="fc" id="L227">            return true</span>
        }
        // if the Swimmer was not found, return false, indicating that the update was not successful
<span class="fc" id="L230">        return false</span>
    }

    /**
     * Loads the swimmers list from the serializer.
     *
     * @throws Exception if an error occurs during the read operation.
     */
    @Throws(Exception::class)
    fun load() {
<span class="fc" id="L240">        swimmers = serializer.read() as ArrayList&lt;Swimmer&gt;</span>
<span class="fc" id="L241">    }</span>

    /**
     * Stores the swimmers list using the serializer.
     *
     * @throws Exception if an error occurs during the write operation.
     */
    @Throws(Exception::class)
    fun store() {
<span class="fc" id="L250">        serializer.write(swimmers)</span>
<span class="fc" id="L251">    }</span>

    /**
     * Formats a list of Swimmer objects into a string representation.
     *
     * @param swimmersToFormat The list of Swimmer objects to be formatted.
     * @return A formatted string containing the list of swimmers.
     */
    private fun formatListString(swimmersToFormat: List&lt;Swimmer&gt;): String =
<span class="fc" id="L260">        swimmersToFormat</span>
<span class="fc" id="L261">            .joinToString(separator = &quot;\n&quot;) { swimmer -&gt;</span>
<span class="fc" id="L262">                swimmers.indexOf(swimmer).toString() + &quot;: &quot; + swimmer.toString()</span>
<span class="fc" id="L263">            }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>